>From 7d0011e35a48b630edfe1345d7de21f0ff25b737 Mon Sep 17 00:00:00 2001
From: Marcus Crestani <crestani@informatik.uni-tuebingen.de>
Date: Wed, 3 Oct 2012 10:38:20 +0200
Subject: [PATCH] Make i3-dump-log work on OS X: shm_open does not support O_TRUNC in OS X.

---
 src/log.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/src/log.c b/src/log.c
index 16fa0be..bd3be3e 100644
--- a/src/log.c
+++ b/src/log.c
@@ -101,14 +101,16 @@ void init_logging(void) {
 #if defined(__APPLE__)
         int mib[2] = { CTL_HW, HW_MEMSIZE };
         size_t length = sizeof(long long);
+	int shm_open_oflags = O_RDWR | O_CREAT;
         sysctl(mib, 2, &physical_mem_bytes, &length, NULL, 0);
 #else
+	int shm_open_oflags = O_RDWR | O_CREAT | O_TRUNC;
         physical_mem_bytes = (long long)sysconf(_SC_PHYS_PAGES) *
                                         sysconf(_SC_PAGESIZE);
 #endif
         logbuffer_size = min(physical_mem_bytes * 0.01, shmlog_size);
         sasprintf(&shmlogname, "/i3-log-%d", getpid());
-        logbuffer_shm = shm_open(shmlogname, O_RDWR | O_CREAT | O_TRUNC, S_IREAD | S_IWRITE);
+        logbuffer_shm = shm_open(shmlogname, shm_open_oflags, S_IREAD | S_IWRITE);
         if (logbuffer_shm == -1) {
             ELOG("Could not shm_open SHM segment for the i3 log: %s\n", strerror(errno));
             return;
-- 
1.6.4.2

